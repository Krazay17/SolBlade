
            // for (const geom of this.allGeoms) {
            //     Object.keys(geom.attributes).forEach(a => {
            //         if (a.startsWith('color')) {
            //             geom.deleteAttribute(a);
            //         }
            //     })
            // }
            // const mergedGeom = mergeGeometries(this.allGeoms);
            // const { vertices, indices } = getVerts(mergedGeom);
            // const colliderDesc = RAPIER.ColliderDesc.trimesh(vertices, indices);
            // colliderDesc.setFriction(0);
            // colliderDesc.setRestitution(0);

            // this.worldCollider = this.physics.createCollider(colliderDesc);

import * as THREE from "three";
import { SOL_PHYSICS_SETTINGS } from "../config/SolConstants";
import { CGame } from "./CGame";
import { CNet } from "./CNet";
import UserInput from "@solblade/client/input/UserInput";

const url = location.hostname === "localhost"
    ? "ws://localhost:8080"
    : "wss://srv.solblade.online";
const canvas = document.getElementById("webgl");
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 1, 1000);
scene.add(camera);

const timeStep = SOL_PHYSICS_SETTINGS.timeStep;
let lastTime = 0, accumulator = 0, focused = true, running = true;
let input, game, net;

async function init() {
    input = new UserInput(canvas);
    game = new CGame(scene, camera, input);
    net = new CNet(url);
    bindings();
    loop();
}
init();

function loop(time) {
    const dt = lastTime - time;
    lastTime = time;
    accumulator += dt;
    if (dt < 1) handleSleep();
    if (running) {
        while (accumulator >= timeStep) {
            if (game) game.step(timeStep);
            accumulator -= timeStep;
        }

        if (game) game.tick(dt);

        if (renderer) renderer.render(scene, camera);
    }
    requestAnimationFrame(loop.bind(this));
}

function handleSleep() {
    if (focused) return;
    running = false
}

function bindings() {
    window.addEventListener("focus", () => {
        focused = true;
        running = true;
    });
    window.addEventListener("blur", () => {
        focused = false;
    });
}